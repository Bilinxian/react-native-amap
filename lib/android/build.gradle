apply plugin: 'com.android.library'
apply plugin: 'kotlin-android'

import com.facebook.react.ReactExtension

def getExt(prop, fallback) {
    rootProject.ext.has(prop) ? rootProject.ext.get(prop) : fallback
}

buildscript {
    ext.kotlin_version = '1.7.21'

    repositories {
        mavenCentral()
        google()
    }

    dependencies {
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
    }
}

android {
    compileSdkVersion getExt('compileSdkVersion', 34)
    buildToolsVersion getExt('buildToolsVersion', '34.0.0')

    defaultConfig {
        minSdkVersion getExt('minSdkVersion', 23)
        targetSdkVersion getExt('targetSdkVersion', 34)
    }
    
    buildFeatures {
        buildConfig true
    }
    
    // 新架构支持
    def reactAndroidProject = findProject(':ReactAndroid')
    if (reactAndroidProject != null) {
        // 使用React Native的codegen配置
        apply plugin: 'com.facebook.react.codegen'
        
        react {
            reactRoot = rootProject.file('../../../')
            codegenDir = new File(reactAndroidProject.projectDir, 'build/generated/source/codegen')
        }
    }
}

dependencies {
    implementation 'com.facebook.react:react-android:+'
    implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version"
    implementation 'com.amap.api:3dmap:9.6.0'
    
    // 新架构依赖
    implementation 'com.facebook.react:react-native-codegen:+'
    implementation 'com.facebook.soloader:soloader:+'
    implementation 'com.facebook.yoga:proguard-annotations:+'
}
